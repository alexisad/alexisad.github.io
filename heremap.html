<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="initial-scale=1.0, width=device-width" />
    <link rel="stylesheet" type="text/css" href="https://js.api.here.com/v3/3.0/mapsjs-ui.css" />
    <script type="text/javascript" src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script type="text/javascript" charset="UTF-8" src="https://js.api.here.com/v3/3.0/mapsjs-core.js"></script>
    <script type="text/javascript" charset="UTF-8" src="https://js.api.here.com/v3/3.0/mapsjs-service.js"></script>
    <script type="text/javascript" charset="UTF-8" src="https://js.api.here.com/v3/3.0/mapsjs-ui.js"></script>
    <script type="text/javascript" charset="UTF-8" src="https://js.api.here.com/v3/3.0/mapsjs-mapevents.js"></script>

    <style type="text/css">
        html {
            overflow: hidden;
        }
        
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100%;
            height: 100%;
            position: absolute;
        }
        
        #mapContainer {
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
            position: absolute;
        }
    </style>

</head>

<body>
    <div id="mapContainer" />
    <script type="text/javascript" charset="UTF-8">
        /**
         * This example overlays a historical map of Berlin
         * from 1789 on top of the base map.
         *
         * @param {H.Map} map A HERE Map instance within the application
         */
        function overlayHistoricalBerlinOld(map) {
            // Create a tile provider from our images of historical Berlin
            var tileProvider = new H.map.provider.ImageTileProvider({
                // We have tiles only for zoom levels 12â€“15,
                // so on all other zoom levels only base map will be visible
                min: 12,
                max: 15,
                opacity: 0.2,
                headers: {
                    customHeader: true
                },
                getURL: function(column, row, zoom) {
                    // If Berlin is not displayed, return a blank tile.
                    if (((zoom == 12) && (row != 1343 || column != 2200)) ||
                        ((zoom == 13) && (row < 2686 || column < 4400 || row > 2687 || column > 4401)) ||
                        ((zoom == 14) && (row < 5372 || column < 8800 || row > 5375 || column > 8803)) ||
                        ((zoom == 15) && (row < 10744 || column < 17601 || row > 10750 || column > 17607))) {
                        return 'https://heremaps.github.io/maps-api-for-javascript-examples/custom-tile-overlay/tiles/blank.png';
                    } else {
                        // The Old Berlin Map Tiler follows the TMS URL specification.
                        // By specification, tiles should be accessible in the following format:
                        // http://server_address/zoom_level/x/y.png
                        return 'https://heremaps.github.io/maps-api-for-javascript-examples/custom-tile-overlay/tiles/' + zoom + '/' + row + '/' + column + '.png';
                    }
                }
            });
            // Unless you own the map tile source,
            // you need to comply with the licensing agreement of the map tile provider.
            // Often this means giving attribution or copyright acknowledgment to the owner,
            // even if the tiles are offered free of charge.
            tileProvider.getCopyrights = function(bounds, level) {
                // We should return an array of objects that implement H.map.ICopyright interface
                return [{
                    label: "Overlay derived from <a href='http://commons.wikimedia.org/wiki/File%3AMap_de_berlin_1789_%28georeferenced%29.jpg' target='_blank'>WikiMedia Commons</a>",
                    alt: 'Overlay Based on a WikiMedia Commons Image in the Public Domain'
                }];
            };
            // Now let's create a layer that will consume tiles from our provider
            var overlayLayer = new H.map.layer.TileLayer(tileProvider, {
                // Let's make it semi-transparent
                opacity: 0.5
            });

            // Finally add our layer containing old Berlin to a map
            map.addLayer(overlayLayer);
        }

        function overlayHistoricalBerlin(map) {
            class CustomProvider extends H.map.provider.RemoteTileProvider {
                    requestInternal(x, y, level, onSuccess, onError) {
                        // If Berlin is not displayed, return a blank tile.
                        if (((level == 12) && (x != 1343 || y != 2200)) ||
                            ((level == 13) && (x < 2686 || y < 4400 || x > 2687 || y > 4401)) ||
                            ((level == 14) && (x < 5372 || y < 8800 || x > 5375 || y > 8803)) ||
                            ((level == 15) && (x < 10744 || y < 17601 || x > 10750 || y > 17607))) {
                            return 'https://heremaps.github.io/maps-api-for-javascript-examples/custom-tile-overlay/tiles/blank.png';
                        } else {
                            // The Old Berlin Map Tiler follows the TMS URL specification.
                            // By specification, tiles should be accessible in the following format:
                            // http://server_address/zoom_level/x/y.png
                            return 'https://heremaps.github.io/maps-api-for-javascript-examples/custom-tile-overlay/tiles/' + level + '/' + x + '/' + y + '.png';
                        }
                        //console.log("x, y, level:", x, y, level);
                        var axResp = axios({
                            method: 'get',
                            url: url,
                            responseType: 'blob',
                            headers: {
                                'customHeader': true
                            }
                        });
                        var vBlob;
                        var img;
                        axResp.then(function(r) {
                            img = new Image();
                            img.addEventListener("load", () => {
                                onSuccess(img);
                                URL.revokeObjectURL(img.src);
                            });
                            img.src = URL.createObjectURL(r.data);
                        });
                    };
                }
                // Create a tile provider from our images of historical Berlin
            var tileProvider = new CustomProvider({
                // We have tiles only for zoom levels 12â€“15
                // so on all other zoom levels only base map will be visible
                min: 12,
                max: 15,
                opacity: 0.2,
                headers: {
                    customHeader: true
                }
            });
            // Unless you own the map tile source,
            // you need to comply with the licensing agreement of the map tile provider.
            // Often this means giving attribution or copyright acknowledgment to the owner,
            // even if the tiles are offered free of charge.
            tileProvider.getCopyrights = function(bounds, level) {
                // We should return an array of objects that implement H.map.ICopyright interface
                return [{
                    label: "Overlay derived from <a href='http://commons.wikimedia.org/wiki/File%3AMap_de_berlin_1789_%28georeferenced%29.jpg' target='_blank'>WikiMedia Commons</a>",
                    alt: 'Overlay Based on a WikiMedia Commons Image in the Public Domain'
                }];
            };
            // Now let's create a layer that will consume tiles from our provider
            var overlayLayer = new H.map.layer.TileLayer(tileProvider, {
                // Let's make it semi-transparent
                opacity: 0.5
            });

            // Finally add our layer containing old Berlin to a map
            map.addLayer(overlayLayer);
        }

        /**
         * Boilerplate map initialization code starts below:
         */

        // Step 1: initialize communication with the platform
        var platform = new H.service.Platform({
            app_id: 'DemoAppId01082013GAL',
            app_code: 'AJKnXv84fjrb0KIHawS0Tg',
            useHTTPS: true,
            useCIT: true
        });
        var defaultLayers = platform.createDefaultLayers();

        // Step 2: initialize a map
        var map = new H.Map(document.getElementById('mapContainer'), defaultLayers.normal.map, {
            center: new H.geo.Point(52.515, 13.405),
            zoom: 14
        });

        // Step 3: make the map interactive
        // mapEvents enables the event system
        // behavior implements default interactions for pan/zoom (also on mobile touch environments)
        var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));

        // Step 4: create the default UI component, for displaying bubbles
        var ui = H.ui.UI.createDefault(map, defaultLayers);

        // Step 5: Main logic goes here
        overlayHistoricalBerlin(map);
    </script>
</body>
</html